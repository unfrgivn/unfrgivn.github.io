---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { ArrowLeft, Calendar, Building, Briefcase, Tag } from 'lucide-react';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { Content } = await project.render();

const { title, summary, role, company, tech, domains, highlights, metrics, media } = project.data;
---

<Layout title={`${title} | Projects`} description={summary}>
  <article class="min-h-screen pb-24 pt-32">
    <div class="container max-w-4xl">
      
      {/* Back Link */}
      <a 
        href="/projects" 
        class="group mb-8 inline-flex items-center gap-2 text-sm text-muted transition-colors hover:text-primary"
      >
        <ArrowLeft className="h-4 w-4 transition-transform group-hover:-translate-x-1" />
        Back to projects
      </a>

      {/* Header */}
      <header class="mb-16">
        <div class="mb-6 flex flex-wrap gap-3">
          {domains && domains.map((domain: string) => (
            <span class="inline-flex items-center rounded-full border border-primary/20 bg-primary/5 px-3 py-1 text-xs font-medium text-primary-2">
              {domain}
            </span>
          ))}
        </div>
        
        <h1 class="mb-6 text-4xl font-bold leading-tight text-text md:text-5xl lg:text-6xl">
          {title}
        </h1>

        <p class="mb-8 text-xl leading-relaxed text-muted/90 md:text-2xl">
          {summary}
        </p>

        {/* Metadata Grid */}
        <div class="grid grid-cols-1 gap-6 rounded-2xl border border-border bg-surface-1 p-6 md:grid-cols-3">
          <div class="flex flex-col gap-1">
            <span class="flex items-center gap-2 text-xs font-mono uppercase tracking-wider text-faint">
              <Building className="h-3 w-3" /> Company
            </span>
            <span class="font-medium text-text">{company}</span>
          </div>
          <div class="flex flex-col gap-1">
            <span class="flex items-center gap-2 text-xs font-mono uppercase tracking-wider text-faint">
              <Briefcase className="h-3 w-3" /> Role
            </span>
            <span class="font-medium text-text">{role}</span>
          </div>
          <div class="flex flex-col gap-1">
            <span class="flex items-center gap-2 text-xs font-mono uppercase tracking-wider text-faint">
              <Tag className="h-3 w-3" /> Tech Stack
            </span>
            <div class="flex flex-wrap gap-1.5">
              {tech.slice(0, 4).map((t: string) => (
                <span class="rounded bg-surface-2 px-1.5 py-0.5 text-[10px] text-muted">{t}</span>
              ))}
              {tech.length > 4 && <span class="text-[10px] text-faint">+{tech.length - 4}</span>}
            </div>
          </div>
        </div>
      </header>

      {/* Metrics Row (if available) */}
      {metrics && metrics.length > 0 && (
        <div class="mb-16 grid grid-cols-2 gap-4 md:grid-cols-4">
          {metrics.map((metric: { label: string; value: string }) => (
            <div class="flex flex-col rounded-xl border border-border/50 bg-surface-1/50 p-4 text-center">
              <span class="text-3xl font-bold text-accent">{metric.value}</span>
              <span class="text-xs font-medium uppercase tracking-wide text-muted">{metric.label}</span>
            </div>
          ))}
        </div>
      )}

      {/* Content Body */}
      <div class="prose prose-invert prose-lg max-w-none 
        prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-text
        prose-p:leading-relaxed prose-p:text-muted/90
        prose-a:text-primary prose-a:no-underline prose-a:transition-colors hover:prose-a:text-primary-2
        prose-strong:text-text prose-strong:font-semibold
        prose-ul:my-6 prose-ul:list-disc prose-ul:pl-6 prose-li:mb-2 prose-li:text-muted/90
        prose-blockquote:border-l-primary prose-blockquote:bg-surface-1/50 prose-blockquote:px-6 prose-blockquote:py-2 prose-blockquote:not-italic prose-blockquote:text-muted
        hr:border-border/50
      ">
        <Content />
      </div>

      {/* Highlights / Deep Dive Section (Bottom) */}
      {highlights && (
        <div class="mt-16 rounded-2xl border border-primary/10 bg-gradient-to-br from-primary/5 to-transparent p-8">
          <h3 class="mb-6 text-xl font-bold text-text">Key Highlights</h3>
          <ul class="grid gap-3 md:grid-cols-1">
            {highlights.map((highlight: string) => (
              <li class="flex items-start gap-3 text-muted/90">
                <span class="mt-2 h-1.5 w-1.5 shrink-0 rounded-full bg-primary"></span>
                {highlight}
              </li>
            ))}
          </ul>
        </div>
      )}

    </div>
  </article>
</Layout>